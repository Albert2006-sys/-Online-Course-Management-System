<div class="student-form-container">
  <!-- Header -->
  <div class="header">
    <h2>
      <mat-icon>{{ isEditMode ? 'edit' : 'person_add' }}</mat-icon>
      {{ isEditMode ? 'Edit Student' : 'Add New Student' }}
    </h2>
    <button mat-button (click)="onCancel()">
      <mat-icon>arrow_back</mat-icon>
      Back
    </button>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading && isEditMode" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading student data...</p>
  </div>

  <!-- Form Card -->
  <mat-card *ngIf="!isLoading || !isEditMode" class="form-card">
    <mat-card-content>
      <form [formGroup]="studentForm" (ngSubmit)="onSubmit()">
        
        <!-- Personal Information Section -->
        <div class="form-section">
          <h3>
            <mat-icon>person</mat-icon>
            Personal Information
          </h3>

          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Full Name</mat-label>
              <input matInput formControlName="name" placeholder="Enter full name">
              <mat-icon matSuffix>badge</mat-icon>
              <mat-error *ngIf="isFieldInvalid('name')">
                {{ getErrorMessage('name') }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>Email</mat-label>
              <input matInput type="email" formControlName="email" placeholder="student@example.com">
              <mat-icon matSuffix>email</mat-icon>
              <mat-error *ngIf="isFieldInvalid('email')">
                {{ getErrorMessage('email') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Phone</mat-label>
              <input matInput formControlName="phone" placeholder="+1 (555) 123-4567">
              <mat-icon matSuffix>phone</mat-icon>
              <mat-error *ngIf="isFieldInvalid('phone')">
                {{ getErrorMessage('phone') }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>Date of Birth</mat-label>
              <input matInput [matDatepicker]="picker" formControlName="dateOfBirth" [max]="maxDate">
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
              <mat-error *ngIf="isFieldInvalid('dateOfBirth')">
                {{ getErrorMessage('dateOfBirth') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Education Level</mat-label>
              <mat-select formControlName="educationLevel">
                <mat-option *ngFor="let level of educationLevels" [value]="level">
                  {{ level }}
                </mat-option>
              </mat-select>
              <mat-icon matSuffix>school</mat-icon>
              <mat-error *ngIf="isFieldInvalid('educationLevel')">
                {{ getErrorMessage('educationLevel') }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>Status</mat-label>
              <mat-select formControlName="status">
                <mat-option *ngFor="let status of statuses" [value]="status">
                  {{ status }}
                </mat-option>
              </mat-select>
              <mat-icon matSuffix>check_circle</mat-icon>
              <mat-error *ngIf="isFieldInvalid('status')">
                {{ getErrorMessage('status') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Profile Image URL</mat-label>
              <input matInput formControlName="profileImage" placeholder="https://example.com/image.jpg">
              <mat-icon matSuffix>image</mat-icon>
            </mat-form-field>
          </div>
        </div>

        <!-- Address Section -->
        <div class="form-section" formGroupName="address">
          <h3>
            <mat-icon>location_on</mat-icon>
            Address
          </h3>

          <div class="form-row">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Street Address</mat-label>
              <input matInput formControlName="street" placeholder="123 Main Street">
              <mat-error *ngIf="isNestedFieldInvalid('address', 'street')">
                {{ getNestedErrorMessage('address', 'street') }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>City</mat-label>
              <input matInput formControlName="city" placeholder="San Francisco">
              <mat-error *ngIf="isNestedFieldInvalid('address', 'city')">
                {{ getNestedErrorMessage('address', 'city') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>State</mat-label>
              <input matInput formControlName="state" placeholder="CA">
              <mat-error *ngIf="isNestedFieldInvalid('address', 'state')">
                {{ getNestedErrorMessage('address', 'state') }}
              </mat-error>
            </mat-form-field>
          </div>

          <div class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>Zip Code</mat-label>
              <input matInput formControlName="zipCode" placeholder="94102">
              <mat-error *ngIf="isNestedFieldInvalid('address', 'zipCode')">
                {{ getNestedErrorMessage('address', 'zipCode') }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Country</mat-label>
              <input matInput formControlName="country" placeholder="United States">
              <mat-error *ngIf="isNestedFieldInvalid('address', 'country')">
                {{ getNestedErrorMessage('address', 'country') }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Interests Section -->
        <div class="form-section">
          <h3>
            <mat-icon>interests</mat-icon>
            Interests
          </h3>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Add Interests</mat-label>
            <mat-chip-grid #chipGrid aria-label="Interest selection">
              <mat-chip-row 
                *ngFor="let interest of interests" 
                (removed)="removeInterest(interest)"
                class="interest-chip"
              >
                {{ interest }}
                <button matChipRemove aria-label="'remove ' + interest">
                  <mat-icon>cancel</mat-icon>
                </button>
              </mat-chip-row>
            </mat-chip-grid>
            <input 
              placeholder="Type and press Enter..."
              [matChipInputFor]="chipGrid"
              [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
              (matChipInputTokenEnd)="addInterest($event)"
            >
            <mat-hint>Add multiple interests by typing and pressing Enter</mat-hint>
          </mat-form-field>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button mat-raised-button type="button" (click)="onCancel()">
            <mat-icon>cancel</mat-icon>
            Cancel
          </button>
          <button 
            mat-raised-button 
            color="primary" 
            type="submit" 
            [disabled]="studentForm.invalid || isLoading"
          >
            <mat-icon>{{ isEditMode ? 'save' : 'add' }}</mat-icon>
            {{ isEditMode ? 'Update Student' : 'Create Student' }}
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
